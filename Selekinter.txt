# gui.py

import tkinter as tk
from tkinter import messagebox
import requests
from datetime import datetime

def format_date(date_str):
    """Convert a yyyy-mm-dd date string to dd-mm-yyyy format."""
    date = datetime.strptime(date_str, "%Y-%m-%d")
    return date.strftime("%d-%m-%Y")

def start_automation():
    # Get the dates from input fields
    from_date_raw = from_date_entry.get()
    to_date_raw = to_date_entry.get()

    # Validate the input dates
    if not from_date_raw or not to_date_raw:
        messagebox.showwarning("Input Error", "Please enter both dates.")
        return

    try:
        from_date = format_date(from_date_raw)
        to_date = format_date(to_date_raw)
    except ValueError:
        messagebox.showwarning("Date Error", "Please enter valid dates in yyyy-mm-dd format.")
        return

    # Send request to FastAPI server
    try:
        response = requests.get(f"http://127.0.0.1:8000/start-automation?from_date={from_date}&to_date={to_date}")
        if response.status_code == 200:
            messagebox.showinfo("Success", response.json()["message"])
        else:
            messagebox.showerror("Error", response.json()["detail"])
    except requests.exceptions.RequestException as e:
        messagebox.showerror("Connection Error", f"Could not reach the server: {e}")

# Set up the Tkinter window
root = tk.Tk()
root.title("AMFI Automation")

tk.Label(root, text="From Date (yyyy-mm-dd):").grid(row=0, column=0, padx=10, pady=10)
from_date_entry = tk.Entry(root)
from_date_entry.grid(row=0, column=1, padx=10, pady=10)

tk.Label(root, text="To Date (yyyy-mm-dd):").grid(row=1, column=0, padx=10, pady=10)
to_date_entry = tk.Entry(root)
to_date_entry.grid(row=1, column=1, padx=10, pady=10)

submit_button = tk.Button(root, text="Start Automation", command=start_automation)
submit_button.grid(row=2, column=0, columnspan=2, pady=20)

root.mainloop()
